# Graphviz å¿ƒæ™ºåœ–åŠŸèƒ½å®‰è£æŒ‡å—

## æ¦‚è¿°

æœ¬å°ˆæ¡ˆæ–°å¢äº†ä½¿ç”¨ Graphviz ç”Ÿæˆé«˜å“è³ª PNG å¿ƒæ™ºåœ–çš„åŠŸèƒ½ï¼Œå¯ä»¥å‰µå»ºå°ˆæ¥­çš„ã€æ”¯æ´ç¹é«”ä¸­æ–‡çš„å¿ƒæ™ºåœ–ã€‚

## å®‰è£éœ€æ±‚

### 1. Python ä¾è³´

å·²ç¶“æ·»åŠ åˆ° `requirements.txt` ä¸­ï¼š

```
graphviz>=0.20.0
```

å®‰è£å‘½ä»¤ï¼š
```bash
cd backend
pip install -r requirements.txt
```

### 2. ç³»çµ± Graphviz å®‰è£

**é‡è¦ï¼š** é™¤äº† Python åº«ï¼Œé‚„éœ€è¦å®‰è£ç³»çµ±ç´šçš„ Graphviz è»Ÿé«”ã€‚

#### Windows
1. ä¸‹è¼‰ Graphviz å®‰è£åŒ…ï¼šhttps://graphviz.org/download/
2. é¸æ“‡ Windows ç‰ˆæœ¬ä¸‹è¼‰ä¸¦å®‰è£
3. ç¢ºä¿å®‰è£è·¯å¾‘æ·»åŠ åˆ°ç³»çµ± PATH ç’°å¢ƒè®Šæ•¸ä¸­
4. é‡å•Ÿå‘½ä»¤æç¤ºç¬¦æˆ– IDE

#### macOS
```bash
brew install graphviz
```

#### Ubuntu/Debian
```bash
sudo apt-get update
sudo apt-get install graphviz
```

#### CentOS/RHEL
```bash
sudo yum install graphviz
# æˆ–è€…ä½¿ç”¨ dnf
sudo dnf install graphviz
```

## åŠŸèƒ½ç‰¹é»

### 1. å¿ƒæ™ºåœ–æ¨£å¼
- **ä¸­å¤®ä¸»é¡Œ**: æ·±è‰²èƒŒæ™¯ (#2c3e50)ï¼Œç™½è‰²æ–‡å­—ï¼Œåœ“è§’çŸ©å½¢
- **ä¸»åˆ†æ”¯**: å½©è‰²èƒŒæ™¯ï¼Œä½¿ç”¨æŸ”å’Œçš„ç²‰å½©è‰²èª¿
- **å­ç¯€é»**: æ·ºç°è‰²èƒŒæ™¯ (#f5f5f5)ï¼Œé»‘è‰²æ–‡å­—
- **é€£æ¥ç·š**: æ›²ç·šæ¨£å¼ï¼Œç°è‰² (#808080)

### 2. å­—é«”æ”¯æ´
- ä½¿ç”¨ `Microsoft JhengHei UI` å­—é«”
- å®Œå…¨æ”¯æ´ç¹é«”ä¸­æ–‡é¡¯ç¤º
- è‡ªå‹•èª¿æ•´å­—é«”å¤§å°

### 3. è¼¸å‡ºæ ¼å¼
- é«˜è§£æåº¦ PNG åœ–åƒ (300 DPI)
- é€æ˜èƒŒæ™¯æ”¯æ´
- é©åˆç”¨æ–¼ç°¡å ±å’Œæ–‡æª”

## API ç«¯é»

### ç”Ÿæˆ PNG å¿ƒæ™ºåœ–
```
POST /api/v1/notes/{task_id}/mindmap-png
```

**å›æ‡‰æ ¼å¼ï¼š**
```json
{
  "status": "success",
  "png_path": "/uploads/mindmap_1234567890.png",
  "full_path": "d:\\AI Tools\\backend\\local_uploads\\mindmap_1234567890.png",
  "message": "PNG å¿ƒæ™ºåœ–ç”ŸæˆæˆåŠŸ"
}
```

### æ¸¬è©¦ç«¯é»
```
POST /api/v1/test-png-mindmap
```

## æ¸¬è©¦å®‰è£

é‹è¡Œæ¸¬è©¦è…³æœ¬ä¾†é©—è­‰å®‰è£ï¼š

```bash
cd backend
python test_graphviz_mindmap.py
```

**é æœŸè¼¸å‡ºï¼š**
```
ğŸ§  Graphviz å¿ƒæ™ºåœ–ç”Ÿæˆæ¸¬è©¦
==================================================
âœ… Graphviz Python åº«å·²å®‰è£
âœ… ç³»çµ± Graphviz å·²æ­£ç¢ºå®‰è£
é–‹å§‹æ¸¬è©¦ Graphviz å¿ƒæ™ºåœ–ç”Ÿæˆ...
âœ… PNG å¿ƒæ™ºåœ–ç”ŸæˆæˆåŠŸï¼
ğŸ“ æ–‡ä»¶è·¯å¾‘: d:\AI Tools\backend\local_uploads\mindmap_1234567890.png
ğŸ“Š æ–‡ä»¶å¤§å°: 45678 bytes
ğŸ¨ å¿ƒæ™ºåœ–å·²ä¿å­˜ï¼Œå¯ä»¥ä½¿ç”¨åœ–ç‰‡æŸ¥çœ‹å™¨æ‰“é–‹æŸ¥çœ‹
```

## æ•…éšœæ’é™¤

### 1. "graphviz executables not found" éŒ¯èª¤
**åŸå› ï¼š** ç³»çµ±æœªå®‰è£ Graphviz æˆ–æœªæ·»åŠ åˆ° PATH

**è§£æ±ºæ–¹æ¡ˆï¼š**
- ç¢ºä¿å·²å®‰è£ç³»çµ±ç´š Graphviz
- æª¢æŸ¥ PATH ç’°å¢ƒè®Šæ•¸
- é‡å•Ÿçµ‚ç«¯æˆ– IDE

### 2. ä¸­æ–‡å­—é«”é¡¯ç¤ºå•é¡Œ
**åŸå› ï¼š** ç³»çµ±ç¼ºå°‘æŒ‡å®šå­—é«”

**è§£æ±ºæ–¹æ¡ˆï¼š**
- Windows: ç¢ºä¿æœ‰ `Microsoft JhengHei UI` å­—é«”
- å…¶ä»–ç³»çµ±: å¯ä»¥ä¿®æ”¹ä»£ç¢¼ä¸­çš„å­—é«”è¨­å®šç‚ºç³»çµ±å¯ç”¨å­—é«”

### 3. æ¬Šé™éŒ¯èª¤
**åŸå› ï¼š** ç„¡æ³•å¯«å…¥è¼¸å‡ºç›®éŒ„

**è§£æ±ºæ–¹æ¡ˆï¼š**
- ç¢ºä¿ `backend/local_uploads` ç›®éŒ„å­˜åœ¨ä¸”å¯å¯«
- æª¢æŸ¥æ–‡ä»¶æ¬Šé™è¨­å®š

## ä½¿ç”¨ç¯„ä¾‹

### Python ä»£ç¢¼ç¯„ä¾‹

```python
from app.services.enhanced_mindmap_generator import generate_enhanced_mindmap

# æº–å‚™å…§å®¹å€å¡Š
content_blocks = [
    {
        "type": "heading_2",
        "content": {"text": "æœƒè­°ä¸»é¡Œ"}
    },
    {
        "type": "bullet_list",
        "content": {
            "items": ["é‡é»ä¸€", "é‡é»äºŒ", "é‡é»ä¸‰"]
        }
    }
]

# ç”Ÿæˆ PNG å¿ƒæ™ºåœ–
png_path = await generate_enhanced_mindmap(content_blocks)
print(f"å¿ƒæ™ºåœ–å·²ç”Ÿæˆ: {png_path}")
```

### å‰ç«¯èª¿ç”¨ç¯„ä¾‹

```javascript
// ç”Ÿæˆ PNG å¿ƒæ™ºåœ–
const response = await fetch(`/api/v1/notes/${taskId}/mindmap-png`, {
  method: 'POST'
});

const result = await response.json();
if (result.status === 'success') {
  // é¡¯ç¤ºç”Ÿæˆçš„å¿ƒæ™ºåœ–
  const imageUrl = result.png_path;
  document.getElementById('mindmap-image').src = imageUrl;
}
```

## å¿ƒæ™ºåœ–æ•¸æ“šçµæ§‹

æ”¯æ´åµŒå¥—å­—å…¸æ ¼å¼ï¼Œç¯„ä¾‹ï¼š

```python
mindmap_data = {
    'æœƒè­°ä¸»é¡Œ': {
        'æˆ°ç•¥è¦åŠƒ': {
            'å¸‚å ´åˆ†æ': ['ç«¶çˆ­å°æ‰‹ç ”ç©¶', 'å¸‚å ´è¶¨å‹¢', 'å®¢æˆ¶éœ€æ±‚'],
            'ç”¢å“ç­–ç•¥': ['åŠŸèƒ½è¦åŠƒ', 'å®šåƒ¹ç­–ç•¥']
        },
        'åŸ·è¡Œè¨ˆç•«': {
            'åœ˜éšŠçµ„å»º': ['äººå“¡æ‹›å‹Ÿ', 'è§’è‰²åˆ†å·¥'],
            'æ™‚ç¨‹å®‰æ’': ['é‡Œç¨‹ç¢‘è¨­å®š', 'äº¤ä»˜æ™‚é–“']
        }
    }
}
```

## æ³¨æ„äº‹é …

1. **æ€§èƒ½è€ƒé‡**: PNG ç”Ÿæˆæ¯” ReactFlow å¿ƒæ™ºåœ–æ…¢ï¼Œé©åˆç”¨æ–¼æœ€çµ‚è¼¸å‡º
2. **æ–‡ä»¶å¤§å°**: ç”Ÿæˆçš„ PNG æ–‡ä»¶è¼ƒå¤§ï¼Œå»ºè­°å®šæœŸæ¸…ç†èˆŠæ–‡ä»¶
3. **å­—é«”ç›¸å®¹æ€§**: ä¸åŒç³»çµ±å¯èƒ½éœ€è¦èª¿æ•´å­—é«”è¨­å®š
4. **è¨˜æ†¶é«”ä½¿ç”¨**: å¤§å‹å¿ƒæ™ºåœ–å¯èƒ½æ¶ˆè€—è¼ƒå¤šè¨˜æ†¶é«”

## æ›´æ–°æ—¥èªŒ

- **v1.0**: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æ´åŸºæœ¬ PNG å¿ƒæ™ºåœ–ç”Ÿæˆ
- **v1.1**: æ·»åŠ ç¹é«”ä¸­æ–‡æ”¯æ´å’Œè‡ªå®šç¾©æ¨£å¼
- **v1.2**: å„ªåŒ–æ€§èƒ½å’ŒéŒ¯èª¤è™•ç†